// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RiskLevel {
  MINIMO
  LEVE
  MODERADO
  MODERADAMENTE_GRAVE
  GRAVE
}

// >>> NOVO: status da triagem
enum ScreeningStatus {
  NEW
  REVIEWED
  SCHEDULED
  CONVERTED
  ARCHIVED
}

// >>> NOVO: status de agendamento
enum AppointmentStatus {
  PENDING
  CONFIRMED
  DONE
  NO_SHOW
  CANCELLED
}

model Student {
  id         String   @id @default(cuid())
  telegramId String?
  nome       String
  idade      Int
  matricula  String   @unique
  curso      String
  periodo    String
  createdAt  DateTime @default(now())

  screenings Screening[]
  // opcional (nÃ£o Ã© necessÃ¡rio para funcionar, mas Ãºtil se quiser navegar):
  // appointments Appointment[]
}

model Screening {
  id        String  @id @default(cuid())
  studentId String
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  phq9Respostas   Int[] // [0..3] x 9
  phq9Score       Int
  gad7Respostas   Int[] // [0..3] x 7
  gad7Score       Int
  disponibilidade String
  observacao      String?
  relatorio       String
  riskPHQ9        RiskLevel
  riskGAD7        RiskLevel
  createdAt       DateTime  @default(now())

  // >>> NOVO: controlar o fluxo da triagem
  status ScreeningStatus @default(NEW)

  // relaÃ§Ã£o 1â€“1 opcional com agendamento (se a triagem jÃ¡ foi agendada)
  appointment Appointment?
}

// >>> NOVO: agendamentos
model Appointment {
  id           String            @id @default(cuid())
  screeningId  String?           @unique
  screening    Screening?        @relation(fields: [screeningId], references: [id])
  caseId       String?
  startsAt     DateTime
  endsAt       DateTime
  durationMin  Int
  channel      String
  professional String
  status       AppointmentStatus @default(PENDING)
  note         String?

  // ðŸ‘‡ 1â€“1 com a nota da sessÃ£o
  sessionNote SessionNote?

  @@index([professional, startsAt, endsAt])
}

model SessionNote {
  id            String      @id @default(cuid())
  appointmentId String      @unique
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  studentId     String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // campos da tela
  before      String?
  complaint   String?
  summary     String?
  observation String?
  evolution   String?
  sharedField String?
  fixedNote   String?
}
